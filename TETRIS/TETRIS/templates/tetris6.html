<html>
<head>
<title>테트리스3</title>	
<style type="text/css">
td{
	width:20px;
	height:24px;
}
</style>
<script>
class Block {
	constructor() {
		this.type = 7;
		this.status= 1;
		this.i=2;
		this.j=2;
	}

}
var b = new Block();

var block2D=[
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0]
];

var stack2D=[
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[1,1,1,1,1, 1,1,1,0,0],	
	[1,1,1,1,1, 1,1,1,0,0]
];

var scrin2D=[
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	

	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0],	
	[0,0,0,0,0, 0,0,0,0,0]
];

function setBlock2DFromBlock(){
	for(var i = 0; i<25; i++){
		for(var j= 0; j<10; j++){
			block2D[i][j]=0;
		}
	}
	
	if(b.type ==1){
		block2D[b.i][b.j]    =b.type;
		block2D[b.i][b.j+1]  =b.type;
		block2D[b.i+1][b.j]  =b.type;
		block2D[b.i+1][b.j+1]=b.type;	
	}
	//긴짝대기
	if(b.type ==2){
		if(b.status ==1){
			block2D[b.i][b.j-1]= b.type;
			block2D[b.i][b.j  ]= b.type;
			block2D[b.i][b.j+1]= b.type;
			block2D[b.i][b.j+2]= b.type;
		}
		if(b.status ==2){
			block2D[b.i-1][b.j] = b.type;
			block2D[b.i][b.j  ] = b.type;
			block2D[b.i+1][b.j] = b.type;
			block2D[b.i+2][b.j] = b.type;
		}
	}
	//번개1
	if(b.type ==3){
		if(b.status ==1){
			block2D[b.i-1][b.j	] = b.type;
			block2D[b.i][b.j	] = b.type;
			block2D[b.i][b.j+1	] = b.type;
			block2D[b.i+1][b.j+1] = b.type;
		}                          
		if(b.status ==2){          
			block2D[b.i][b.j-1	] = b.type;
			block2D[b.i][b.j	] = b.type;
			block2D[b.i-1][b.j	] = b.type;
			block2D[b.i-1][b.j+1] = b.type;
		}
	}	
	//번개2
	if(b.type ==4){
		if(b.status ==1){
			block2D[b.i-1][b.j+1] 	= b.type;
			block2D[b.i][b.j]		= b.type;
			block2D[b.i][b.j+1]		= b.type;
			block2D[b.i+1][b.j] 	= b.type;
		}
		if(b.status ==2){
			block2D[b.i-1][b.j-1]   = b.type;
			block2D[b.i-1][b.j]	 = b.type;
			block2D[b.i][b.j]		 = b.type;
			block2D[b.i][b.j+1]	 = b.type;
		}
	}
	
	//ㄴ
	if(b.type ==5){
		if(b.status ==1){		
			block2D[b.i-1	][b.j	]=b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i+1	][b.j	]=b.type;
			block2D[b.i+1	][b.j+1	]=b.type;
		}
		if(b.status ==2){		 
			block2D[b.i	][b.j-1	] 	 =b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i	][b.j+1	]	 =b.type;
			block2D[b.i+1	][b.j-1	]=b.type;
			
		}
		if(b.status ==3){		
			block2D[b.i-1	][b.j-1	]=b.type;
			block2D[b.i-1	][b.j	]=b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i+1	][b.j	]=b.type;
		}
		if(b.status ==4){		
			block2D[b.i	][b.j-1	]	 =b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i	][b.j+1	]	 =b.type;
			block2D[b.i-1	][b.j+1	]=b.type;
		}
	}
	//반대 ㄴ
	if(b.type ==6){
		if(b.status ==1){		
			block2D[b.i-1	][b.j	]=b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i+1	][b.j	]=b.type;
			block2D[b.i+1	][b.j-1	]=b.type;
		}
		if(b.status ==2){		
			block2D[b.i-1	][b.j-1	]=b.type;
			block2D[b.i	][b.j-1	]=b.type;
			block2D[b.i	][b.j	]=b.type;
			block2D[b.i	][b.j+1	]=b.type;
		}
		if(b.status ==3){		
			block2D[b.i-1	][b.j+1	]=b.type;
			block2D[b.i-1	][b.j	]=b.type;
			block2D[b.i	][b.j	]	 =b.type;
			block2D[b.i+1	][b.j	]=b.type;
		}
		if(b.status ==4){		
			block2D[b.i	][b.j-1	]=b.type;
			block2D[b.i	][b.j	]=b.type;
			block2D[b.i	][b.j+1	]=b.type;
			block2D[b.i+1	][b.j+1	]=b.type;
		}
		
	}
	//법규	
	if(b.type ==7){
		if(b.status ==1){
			block2D[b.i-1	][b.j	]=b.type;
			block2D[b.i	][b.j	]=b.type;
			block2D[b.i	][b.j-1	]=b.type;
			block2D[b.i	][b.j+1	]=b.type;
		}
		if(b.status ==2){
			block2D[b.i-1][b.j]=b.type;
			block2D[b.i][b.j]  =b.type;
			block2D[b.i+1][b.j]=b.type;
			block2D[b.i][b.j+1]=b.type;
		}
		if(b.status ==3){
			block2D[b.i  ][b.j-1] =b.type;
			block2D[b.i  ][b.j	] =b.type;
			block2D[b.i  ][b.j+1] =b.type;
			block2D[b.i+1][b.j	] =b.type;
		}
		if(b.status ==4){
			block2D[b.i	 ][b.j-1]	=b.type;
			block2D[b.i	 ][b.j  ]	=b.type;
			block2D[b.i-1][b.j  ]	=b.type;
			block2D[b.i+1][b.j  ]	=b.type;
		}
	}
}
function setScrin2D(){
	for(var i=0;i<25;i++){
		for(var j=0;j<10;j++){
			scrin2D[i][j]=0;
		}
	}
	
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			if(block2D[i][j]>0){
				scrin2D[i][j] = block2D[i][j];
			}
		}
	}
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			if(stack2D[i][j]>0){
				scrin2D[i][j] = stack2D[i][j]
			}
		}
	}
} 
function myrender(){
	var tds = document.querySelectorAll("td");
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			var idx = parseInt(i*10 + j);
			if(scrin2D[i][j]== 0){
				tds[idx].style.backgroundColor = "white";
			}
			if(scrin2D[i][j]== 1){
				tds[idx].style.backgroundColor = "red";
			}
			if(scrin2D[i][j]== 2){
				tds[idx].style.backgroundColor = "orange";
			}
			if(scrin2D[i][j]== 3){
				tds[idx].style.backgroundColor = "green";
			}
			if(scrin2D[i][j]== 4){
				tds[idx].style.backgroundColor = "blue";
			}
			if(scrin2D[i][j]== 5){
				tds[idx].style.backgroundColor = "purple";
			}
			if(scrin2D[i][j]== 6){
				tds[idx].style.backgroundColor = "pink";
			}
			if(scrin2D[i][j]== 7){
				tds[idx].style.backgroundColor = "yellow";
			}
			if(scrin2D[i][j]== 11){
				tds[idx].style.backgroundColor = "light red";
			}
			if(scrin2D[i][j]== 12){
				tds[idx].style.backgroundColor = "light orange";
			}
			if(scrin2D[i][j]== 13){
				tds[idx].style.backgroundColor = "light green";
			}
			if(scrin2D[i][j]== 14){
				tds[idx].style.backgroundColor = "light blue";
			}
			if(scrin2D[i][j]== 15){
				tds[idx].style.backgroundColor = "light purple";
			}
			if(scrin2D[i][j]== 16){
				tds[idx].style.backgroundColor = "light pink";
			}
			if(scrin2D[i][j]== 17){
				tds[idx].style.backgroundColor = "light yellow";
			}
			
		}
	}
	
}
window.addEventListener("keydown", (e) =>{
	myclick(e);
});
function isCrushWall(){
	var cnt = 0;
	var flag = false;
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			if(block2D[i][j]> 0){
				cnt++;
			}
		}
	}
	if(cnt ==4)
		flag = false;
	else
		flag = true;
	
	return flag;
}
function isCrushStack(){
	var flag = false;
	
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			if(block2D[i][j] >0 && stack2D[i][j]>0){
				flag = true;
			}
			
			
		}
	}
	return flag; 
}
function moveBlock2DToStack2D(){
	for(var i = 0; i<25; i++){
		for(var j = 0; j<10; j++){
			if(block2D[i][j] >0){
				stack2D[i][j] = block2D[i][j]+10;
			}			
		}
	}
}

function myclick(e){
	var bakType = b.type;
	var bakStatus = b.status
	var bakI = b.i;
	var bakJ = b.j;
	
	var flagDown = false;
	if(e.code =="ArrowUp"){
		changeStatus();
	}
	if(e.code =="ArrowDown"){
		b.i++;
		flagDown = true;
	}
	if(e.code =="ArrowLeft"){
		b.j--;
	}
	if(e.code =="ArrowRight"){
		b.j++;
	}
	
	var flagUnder = false;
	try {
		setBlock2DFromBlock();
	} catch (e) {
		flagUnder = true;
	}
	
	setScrin2D();
	var flagWall = isCrushWall();
	var flagStack = isCrushStack();
	
	var flagCrush = flagWall || flagStack ||flagUnder;
	
	if(flagCrush){
		b.type = bakType;
		b.status = bakStatus
		b.i = bakI
		b.j = bakJ
		setBlock2DFromBlock();
		setScrin2D();
	
		
		if(flagDown){
			moveBlock2DToStack2D();
			
			var cnt10 = getCnt10();
			
			remove10(cnt10);
			console.log("cnt10",cnt10);
			b.type		= parseInt(Math.random()*7+1);
			b.status 	= 1;
			b.i 		= 2;
			b.j 		= 2;
			setBlock2DFromBlock();
			setScrin2D();
			count();
		}
	
	}
		
	myrender();
	
}
function count(){
	
	var count = document.querySelector.val("#mydiv");
	console.log("count",count)

}
function remove10(cnt10){
	var s2D = [];
	for(var i = 0; i<25; i++){
		if(
			stack2D[i][0] >0 &&
			stack2D[i][1] >0 &&
			stack2D[i][2] >0 &&
			stack2D[i][3] >0 &&
			stack2D[i][4] >0 &&
			stack2D[i][5] >0 &&
			stack2D[i][6] >0 &&
			stack2D[i][7] >0 &&
			stack2D[i][8] >0 &&
			stack2D[i][9] >0
		){
		}else{
			s2D.push(stack2D[i]+"");
		}
	}
	for(var i = 0; i<cnt10; i++){
		s2D.unshift([0,0,0,0,0  ,0,0,0,0,0]+"");
	}
	for(var i=0; i<25;i++){
		stack2D[i][0] = parseInt(s2D[i].split(",")[0]);
		stack2D[i][1] = parseInt(s2D[i].split(",")[1]);
		stack2D[i][2] = parseInt(s2D[i].split(",")[2]);
		stack2D[i][3] = parseInt(s2D[i].split(",")[3]);
		stack2D[i][4] = parseInt(s2D[i].split(",")[4]);
		stack2D[i][5] = parseInt(s2D[i].split(",")[5]);
		
		stack2D[i][6] = parseInt(s2D[i].split(",")[6]);
		stack2D[i][7] = parseInt(s2D[i].split(",")[7]);
		stack2D[i][8] = parseInt(s2D[i].split(",")[8]);
		stack2D[i][9] = parseInt(s2D[i].split(",")[9]);
	}
	console.log("s2D",s2D);
}
function getCnt10(){
	var cnt = 0;
	for(var i = 0; i<25; i++){
		if(stack2D[i][0]>0 &&
		   stack2D[i][1]>0 &&
		   stack2D[i][2]>0 &&
		   stack2D[i][3]>0 &&
		   stack2D[i][4]>0 &&
		   stack2D[i][5]>0 &&
		   stack2D[i][6]>0 &&
		   stack2D[i][7]>0 &&
		   stack2D[i][8]>0 &&
		   stack2D[i][9]>0
		){
			cnt++;
		}
	}
	
	return cnt;
}
function changeStatus(){
	if(b.type ==2 || b.type == 3 || b.type == 4){
		if(b.status == 1){
			b.status =2;
		}else if(b.status ==2){
			b.status = 1;
		}
	}
	if(b.type ==5 || b.type == 6 || b.type == 7){
		if(b.status == 1){
			b.status =2;
		}else if(b.status ==2){
			b.status = 3;
		}else if(b.status == 3){
			b.status =4;
		}else if(b.status ==4){
			b.status = 1;
		}
	}
	
	
}
function myinit(){
	setBlock2DFromBlock();//블록을 설정
	setScrin2D();
	myrender();
	
}
</script>
</head>
<body onload="myinit()">
Mission:<div id="mydiv">10</div>
다음 블록이 나올때 10이 줄어든다.

	<table border="1px">
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td>
			<td></td><td></td><td></td><td></td><td></td>
		</tr>
		
		
		
		
	</table>
</body>
</html>